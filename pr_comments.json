[{"url":"https://api.github.com/repos/jochym/opendata/pulls/comments/2835392430","pull_request_review_id":3834520018,"id":2835392430,"node_id":"PRRC_kwDONWskwc6pAKeu","diff_hunk":"@@ -544,3 +544,140 @@ async def handle_clear_metadata(ctx: AppContext):\n     from opendata.ui.components.metadata import handle_clear_metadata as hcm\n \n     await hcm(ctx)\n+\n+\n+def open_file_selection_dialog(ctx: AppContext):\n+    \"\"\"Opens a dialog for manual file selection with categories.\"\"\"\n+    if not ctx.agent.current_fingerprint:\n+        ui.notify(_(\"Please scan the project first.\"), type=\"warning\")\n+        return\n+\n+    # Get all files from inventory (use session cache)\n+    inventory = (\n+        ctx.session.inventory_cache\n+        if hasattr(ctx, \"session\") and ctx.session.inventory_cache\n+        else []\n+    )\n+\n+    # Category options\n+    CATEGORIES = {\n+        \"main_article\": _(\"Main Article/Paper\"),\n+        \"visualization_scripts\": _(\"Visualization Scripts\"),\n+        \"data_files\": _(\"Data Files\"),\n+        \"documentation\": _(\"Documentation\"),\n+        \"other\": _(\"Other\"),\n+    }\n+\n+    # Current selections (from existing analysis or empty)\n+    current_selections = {}\n+    if ctx.agent.current_analysis and ctx.agent.current_analysis.file_suggestions:\n+        for fs in ctx.agent.current_analysis.file_suggestions:\n+            # Infer category from reason\n+            reason_lower = fs.reason.lower()\n+            if (\n+                \"main\" in reason_lower\n+                or \"article\" in reason_lower\n+                or \"paper\" in reason_lower\n+            ):\n+                current_selections[fs.path] = \"main_article\"\n+            elif \"visual\" in reason_lower or \"script\" in reason_lower:\n+                current_selections[fs.path] = \"visualization_scripts\"\n+            elif \"data\" in reason_lower:\n+                current_selections[fs.path] = \"data_files\"\n+            elif \"doc\" in reason_lower:\n+                current_selections[fs.path] = \"documentation\"\n+            else:\n+                current_selections[fs.path] = \"other\"\n+\n+    # Build dialog\n+    with ui.dialog() as dialog, ui.card().classes(\"w-[700px] h-[600px]\"):\n+        ui.label(_(\"Select Significant Files\")).classes(\"text-h6 mb-2\")\n+        ui.markdown(\n+            _(\n+                \"**Instructions:** Select files for deep analysis and assign categories. \"\n+                \"The AI will read these files to extract metadata.\"\n+            )\n+        ).classes(\"text-sm text-slate-600 mb-4\")\n+\n+        # File selection table\n+        selected_paths = {}\n+\n+        with ui.scroll_area().classes(\"h-96 w-full border rounded-md\"):\n+            with ui.column().classes(\"gap-0\"):\n+                # Header\n+                with ui.row().classes(\n+                    \"w-full items-center gap-2 p-2 bg-slate-100 font-bold text-sm\"\n+                ):\n+                    ui.label(_(\"File\")).classes(\"flex-grow\")\n+                    ui.label(_(\"Category\")).classes(\"w-48\")\n+\n+                # Files\n+                for item in inventory:\n+                    path = item.get(\"path\", \"\")\n+                    if not path or item.get(\"type\") == \"folder\":\n+                        continue\n+\n+                    with ui.row().classes(\n+                        \"w-full items-center gap-2 p-1 hover:bg-slate-50\"\n+                    ):\n+                        # Checkbox\n+                        is_selected = path in current_selections\n+                        cb = ui.checkbox(\n+                            value=is_selected,\n+                            on_change=lambda e, p=path: (\n+                                selected_paths.update({p: \"other\"})\n+                                if e.value\n+                                else selected_paths.pop(p, None)\n+                            ),\n+                        ).props(\"dense\")","path":"src/opendata/ui/components/chat.py","commit_id":"33b0aece1d8c32b449877c68b8ec8df1f19c253c","original_commit_id":"215b468c39b8a8d2f3aaca6659227186b6d4cc12","user":{"login":"Copilot","id":175728472,"node_id":"BOT_kgDOCnlnWA","avatar_url":"https://avatars.githubusercontent.com/in/946600?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-pull-request-reviewer","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"When a checkbox is checked, the file is added with category 'other' regardless of what the user selected in the dropdown. The logic should preserve the existing category from `current_selections` or the dropdown's current value, not hardcode 'other'.","created_at":"2026-02-20T22:48:13Z","updated_at":"2026-02-20T22:48:14Z","html_url":"https://github.com/jochym/opendata/pull/21#discussion_r2835392430","pull_request_url":"https://api.github.com/repos/jochym/opendata/pulls/21","_links":{"self":{"href":"https://api.github.com/repos/jochym/opendata/pulls/comments/2835392430"},"html":{"href":"https://github.com/jochym/opendata/pull/21#discussion_r2835392430"},"pull_request":{"href":"https://api.github.com/repos/jochym/opendata/pulls/21"}},"reactions":{"url":"https://api.github.com/repos/jochym/opendata/pulls/comments/2835392430/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":625,"start_side":"RIGHT","line":null,"original_line":632,"side":"RIGHT","author_association":"CONTRIBUTOR","original_position":116,"position":1,"subject_type":"line"},{"url":"https://api.github.com/repos/jochym/opendata/pulls/comments/2835392442","pull_request_review_id":3834520018,"id":2835392442,"node_id":"PRRC_kwDONWskwc6pAKe6","diff_hunk":"@@ -544,3 +544,140 @@ async def handle_clear_metadata(ctx: AppContext):\n     from opendata.ui.components.metadata import handle_clear_metadata as hcm\n \n     await hcm(ctx)\n+\n+\n+def open_file_selection_dialog(ctx: AppContext):\n+    \"\"\"Opens a dialog for manual file selection with categories.\"\"\"\n+    if not ctx.agent.current_fingerprint:\n+        ui.notify(_(\"Please scan the project first.\"), type=\"warning\")\n+        return\n+\n+    # Get all files from inventory (use session cache)\n+    inventory = (\n+        ctx.session.inventory_cache\n+        if hasattr(ctx, \"session\") and ctx.session.inventory_cache\n+        else []\n+    )\n+\n+    # Category options\n+    CATEGORIES = {\n+        \"main_article\": _(\"Main Article/Paper\"),\n+        \"visualization_scripts\": _(\"Visualization Scripts\"),\n+        \"data_files\": _(\"Data Files\"),\n+        \"documentation\": _(\"Documentation\"),\n+        \"other\": _(\"Other\"),\n+    }\n+\n+    # Current selections (from existing analysis or empty)\n+    current_selections = {}\n+    if ctx.agent.current_analysis and ctx.agent.current_analysis.file_suggestions:\n+        for fs in ctx.agent.current_analysis.file_suggestions:\n+            # Infer category from reason\n+            reason_lower = fs.reason.lower()\n+            if (\n+                \"main\" in reason_lower\n+                or \"article\" in reason_lower\n+                or \"paper\" in reason_lower\n+            ):\n+                current_selections[fs.path] = \"main_article\"\n+            elif \"visual\" in reason_lower or \"script\" in reason_lower:\n+                current_selections[fs.path] = \"visualization_scripts\"\n+            elif \"data\" in reason_lower:\n+                current_selections[fs.path] = \"data_files\"\n+            elif \"doc\" in reason_lower:\n+                current_selections[fs.path] = \"documentation\"\n+            else:\n+                current_selections[fs.path] = \"other\"\n+\n+    # Build dialog\n+    with ui.dialog() as dialog, ui.card().classes(\"w-[700px] h-[600px]\"):\n+        ui.label(_(\"Select Significant Files\")).classes(\"text-h6 mb-2\")\n+        ui.markdown(\n+            _(\n+                \"**Instructions:** Select files for deep analysis and assign categories. \"\n+                \"The AI will read these files to extract metadata.\"\n+            )\n+        ).classes(\"text-sm text-slate-600 mb-4\")\n+\n+        # File selection table\n+        selected_paths = {}\n+\n+        with ui.scroll_area().classes(\"h-96 w-full border rounded-md\"):\n+            with ui.column().classes(\"gap-0\"):\n+                # Header\n+                with ui.row().classes(\n+                    \"w-full items-center gap-2 p-2 bg-slate-100 font-bold text-sm\"\n+                ):\n+                    ui.label(_(\"File\")).classes(\"flex-grow\")\n+                    ui.label(_(\"Category\")).classes(\"w-48\")\n+\n+                # Files\n+                for item in inventory:\n+                    path = item.get(\"path\", \"\")\n+                    if not path or item.get(\"type\") == \"folder\":\n+                        continue\n+\n+                    with ui.row().classes(\n+                        \"w-full items-center gap-2 p-1 hover:bg-slate-50\"\n+                    ):\n+                        # Checkbox\n+                        is_selected = path in current_selections\n+                        cb = ui.checkbox(\n+                            value=is_selected,\n+                            on_change=lambda e, p=path: (\n+                                selected_paths.update({p: \"other\"})\n+                                if e.value\n+                                else selected_paths.pop(p, None)\n+                            ),\n+                        ).props(\"dense\")\n+\n+                        # File path\n+                        ui.label(path).classes(\"flex-grow text-sm font-mono truncate\")\n+\n+                        # Category dropdown (only enabled if selected)\n+                        cat_select = (\n+                            ui.select(\n+                                options=CATEGORIES,\n+                                value=current_selections.get(path, \"other\"),\n+                                on_change=lambda e, p=path: selected_paths.update(\n+                                    {p: e.value}\n+                                )\n+                                if e.value\n+                                else None,\n+                            )\n+                            .props(\"dense size=sm\")\n+                            .classes(\"w-48\")\n+                        )","path":"src/opendata/ui/components/chat.py","commit_id":"215b468c39b8a8d2f3aaca6659227186b6d4cc12","original_commit_id":"215b468c39b8a8d2f3aaca6659227186b6d4cc12","user":{"login":"Copilot","id":175728472,"node_id":"BOT_kgDOCnlnWA","avatar_url":"https://avatars.githubusercontent.com/in/946600?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-pull-request-reviewer","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"The dropdown's on_change updates `selected_paths` only when the file is already checked, but checking the checkbox doesn't initialize the path in `selected_paths` with the dropdown's current value. This creates a disconnect where the dropdown displays one category but `selected_paths` contains a different one.","created_at":"2026-02-20T22:48:13Z","updated_at":"2026-02-20T22:48:14Z","html_url":"https://github.com/jochym/opendata/pull/21#discussion_r2835392442","pull_request_url":"https://api.github.com/repos/jochym/opendata/pulls/21","_links":{"self":{"href":"https://api.github.com/repos/jochym/opendata/pulls/comments/2835392442"},"html":{"href":"https://github.com/jochym/opendata/pull/21#discussion_r2835392442"},"pull_request":{"href":"https://api.github.com/repos/jochym/opendata/pulls/21"}},"reactions":{"url":"https://api.github.com/repos/jochym/opendata/pulls/comments/2835392442/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":638,"start_side":"RIGHT","line":null,"original_line":650,"side":"RIGHT","author_association":"CONTRIBUTOR","original_position":134,"position":1,"subject_type":"line"},{"url":"https://api.github.com/repos/jochym/opendata/pulls/comments/2835392451","pull_request_review_id":3834520018,"id":2835392451,"node_id":"PRRC_kwDONWskwc6pAKfD","diff_hunk":"@@ -544,3 +544,140 @@ async def handle_clear_metadata(ctx: AppContext):\n     from opendata.ui.components.metadata import handle_clear_metadata as hcm\n \n     await hcm(ctx)\n+\n+\n+def open_file_selection_dialog(ctx: AppContext):\n+    \"\"\"Opens a dialog for manual file selection with categories.\"\"\"\n+    if not ctx.agent.current_fingerprint:\n+        ui.notify(_(\"Please scan the project first.\"), type=\"warning\")\n+        return\n+\n+    # Get all files from inventory (use session cache)\n+    inventory = (\n+        ctx.session.inventory_cache\n+        if hasattr(ctx, \"session\") and ctx.session.inventory_cache\n+        else []\n+    )\n+\n+    # Category options\n+    CATEGORIES = {\n+        \"main_article\": _(\"Main Article/Paper\"),\n+        \"visualization_scripts\": _(\"Visualization Scripts\"),\n+        \"data_files\": _(\"Data Files\"),\n+        \"documentation\": _(\"Documentation\"),\n+        \"other\": _(\"Other\"),\n+    }\n+\n+    # Current selections (from existing analysis or empty)\n+    current_selections = {}\n+    if ctx.agent.current_analysis and ctx.agent.current_analysis.file_suggestions:\n+        for fs in ctx.agent.current_analysis.file_suggestions:\n+            # Infer category from reason\n+            reason_lower = fs.reason.lower()\n+            if (\n+                \"main\" in reason_lower\n+                or \"article\" in reason_lower\n+                or \"paper\" in reason_lower\n+            ):\n+                current_selections[fs.path] = \"main_article\"\n+            elif \"visual\" in reason_lower or \"script\" in reason_lower:\n+                current_selections[fs.path] = \"visualization_scripts\"\n+            elif \"data\" in reason_lower:\n+                current_selections[fs.path] = \"data_files\"\n+            elif \"doc\" in reason_lower:\n+                current_selections[fs.path] = \"documentation\"\n+            else:\n+                current_selections[fs.path] = \"other\"\n+\n+    # Build dialog\n+    with ui.dialog() as dialog, ui.card().classes(\"w-[700px] h-[600px]\"):\n+        ui.label(_(\"Select Significant Files\")).classes(\"text-h6 mb-2\")\n+        ui.markdown(\n+            _(\n+                \"**Instructions:** Select files for deep analysis and assign categories. \"\n+                \"The AI will read these files to extract metadata.\"\n+            )\n+        ).classes(\"text-sm text-slate-600 mb-4\")\n+\n+        # File selection table\n+        selected_paths = {}\n+\n+        with ui.scroll_area().classes(\"h-96 w-full border rounded-md\"):\n+            with ui.column().classes(\"gap-0\"):\n+                # Header\n+                with ui.row().classes(\n+                    \"w-full items-center gap-2 p-2 bg-slate-100 font-bold text-sm\"\n+                ):\n+                    ui.label(_(\"File\")).classes(\"flex-grow\")\n+                    ui.label(_(\"Category\")).classes(\"w-48\")\n+\n+                # Files\n+                for item in inventory:\n+                    path = item.get(\"path\", \"\")\n+                    if not path or item.get(\"type\") == \"folder\":\n+                        continue\n+\n+                    with ui.row().classes(\n+                        \"w-full items-center gap-2 p-1 hover:bg-slate-50\"\n+                    ):\n+                        # Checkbox\n+                        is_selected = path in current_selections\n+                        cb = ui.checkbox(\n+                            value=is_selected,\n+                            on_change=lambda e, p=path: (\n+                                selected_paths.update({p: \"other\"})\n+                                if e.value\n+                                else selected_paths.pop(p, None)\n+                            ),\n+                        ).props(\"dense\")","path":"src/opendata/ui/components/chat.py","commit_id":"33b0aece1d8c32b449877c68b8ec8df1f19c253c","original_commit_id":"215b468c39b8a8d2f3aaca6659227186b6d4cc12","user":{"login":"Copilot","id":175728472,"node_id":"BOT_kgDOCnlnWA","avatar_url":"https://avatars.githubusercontent.com/in/946600?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-pull-request-reviewer","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"The checkbox initialization doesn't populate `selected_paths` for files in `current_selections`. When the dialog opens with pre-selected files, those files should be added to `selected_paths` with their existing categories so they're included when the user clicks Apply.","created_at":"2026-02-20T22:48:13Z","updated_at":"2026-02-20T22:48:13Z","html_url":"https://github.com/jochym/opendata/pull/21#discussion_r2835392451","pull_request_url":"https://api.github.com/repos/jochym/opendata/pulls/21","_links":{"self":{"href":"https://api.github.com/repos/jochym/opendata/pulls/comments/2835392451"},"html":{"href":"https://github.com/jochym/opendata/pull/21#discussion_r2835392451"},"pull_request":{"href":"https://api.github.com/repos/jochym/opendata/pulls/21"}},"reactions":{"url":"https://api.github.com/repos/jochym/opendata/pulls/comments/2835392451/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":625,"start_side":"RIGHT","line":null,"original_line":632,"side":"RIGHT","author_association":"CONTRIBUTOR","original_position":116,"position":1,"subject_type":"line"}]